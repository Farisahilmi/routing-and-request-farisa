<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <%- include('nav') %>
    <% if (users && users.length > 0) { %>
      <table border="1" cellpadding="8">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Password</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(function(user) { %>
            <tr>
              <td><%= user.id %></td>
              <td><%= user.username %></td>
              <td><%= user.email %></td>
              <td><%= user.password %></td>
              <td>
                <a href="/users/update/<%= user.id %>">Update</a>
                <button type="button" onclick="deleteUser('<%= user.id %>')">Delete</button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p>No users found.</p>
    <% } %>
    <script>
      async function deleteUser(id) {
        if (!confirm('Are you sure you want to delete this user?')) return;
        const response = await fetch('/users/' + id, {
          method: 'DELETE'
        });
        const result = await response.json();
        if (result.status === 'success') {
          alert(result.message);
          window.location.reload();
        } else {
          alert(result.message || 'Failed to delete user.');
        }
      }
    </script>
  </body>
</html>
