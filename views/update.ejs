<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <form id="updateUserForm">
        <p>
            <label for="username">Username:</label>
            <input 
              type="text" 
              id="username" 
              name="username" 
              value="<%= user ? user.username : '' %>"
              required
            />
        </p>
        <p>
            <label for="email">Email:</label>
            <input 
              type="email" 
              id="email" 
              name="email"
              value="<%= user ? user.email : '' %>"
              required
            />
        </p>
        <p>
            <label for="password">Password:</label> 
            <input 
              type="password" 
              id="password" 
              name="password"
              value="<%= user ? user.password : '' %>"
              required
            />
        </p>
        <button type="submit">Update</button>
    </form>
    <script>
      document.getElementById('updateUserForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
          username: form.username.value,
          email: form.email.value,
          password: form.password.value
        };
        const userId = "<%= user ? user.id : '' %>";
        const response = await fetch('/users/' + userId, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        if (result.status === 'success') {
          alert(result.message);
          window.location.href = '/users';
        } else {
          alert(result.message || 'Failed to update user');
        }
      });
    </script>
  </body>
</html>
